# 📊 구글 시트 연동 완벽 가이드

상담 문의를 [이 구글 시트](https://docs.google.com/spreadsheets/d/1U-B4Qi4_kE59JEeKcInSOtGOX93kHyQIRXC4SnolxSk/edit?usp=sharing)에 자동으로 저장하는 방법입니다.

---

## ✅ 1단계: 구글 시트 헤더 설정

1. [구글 시트 열기](https://docs.google.com/spreadsheets/d/1U-B4Qi4_kE59JEeKcInSOtGOX93kHyQIRXC4SnolxSk/edit?usp=sharing)
2. 첫 번째 행(1번 행)에 다음 헤더 입력:

| A1 | B1 | C1 | D1 | E1 |
|----|----|----|----|----|
| 접수일시 | 기업명 | 연락처 | 담당자명 | 문의사항 |

---

## ✅ 2단계: Google Apps Script 설정

### 2-1. Apps Script 열기
1. 구글 시트 상단 메뉴: **확장 프로그램 > Apps Script** 클릭
2. 새 탭이 열리면서 Apps Script 에디터가 나타남

### 2-2. 코드 입력
1. 기존 코드(`function myFunction() { ... }`) **전체 삭제**
2. 프로젝트 폴더의 `google-apps-script.js` 파일 내용을 **복사**
3. Apps Script 에디터에 **붙여넣기**

또는 아래 코드를 직접 복사:

```javascript
function doPost(e) {
  try {
    var sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
    var params = e.parameter;
    var timestamp = params.timestamp || new Date().toLocaleString('ko-KR', { timeZone: 'Asia/Seoul' });
    var companyName = params.company_name || '';
    var contactNumber = params.contact_number || '';
    var managerName = params.manager_name || '';
    var inquiryContent = params.inquiry_content || '';
    
    sheet.appendRow([
      timestamp,
      companyName,
      contactNumber,
      managerName,
      inquiryContent
    ]);
    
    return ContentService
      .createTextOutput(JSON.stringify({
        'status': 'success',
        'message': '상담 문의가 구글 시트에 저장되었습니다.'
      }))
      .setMimeType(ContentService.MimeType.JSON);
      
  } catch (error) {
    return ContentService
      .createTextOutput(JSON.stringify({
        'status': 'error',
        'message': error.toString()
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

function doGet(e) {
  return ContentService
    .createTextOutput(JSON.stringify({
      'status': 'success',
      'message': 'Apps Script가 정상 작동 중입니다.',
      'timestamp': new Date().toLocaleString('ko-KR', { timeZone: 'Asia/Seoul' })
    }))
    .setMimeType(ContentService.MimeType.JSON);
}
```

### 2-3. 저장
- **저장 아이콘(💾)** 클릭 또는 `Ctrl + S`
- 프로젝트 이름 입력: `포켓에듀 상담 문의 수집기`
- **확인** 클릭

---

## ✅ 3단계: 웹 앱으로 배포

### 3-1. 배포 시작
1. 상단 메뉴: **배포 > 새 배포** 클릭

### 3-2. 설정
1. **유형 선택**: ⚙️ (톱니바퀴) 아이콘 클릭 > **웹 앱** 선택
2. 설정 입력:
   - **설명**: `상담 문의 수집`
   - **실행 주체**: `나`
   - **액세스 권한**: ⚠️ **모든 사용자** (매우 중요!)
3. **배포** 클릭

### 3-3. 권한 승인
1. **"권한 검토"** 버튼 클릭
2. Google 계정 선택
3. ⚠️ "이 앱은 확인되지 않았습니다" 메시지가 나타나면:
   - **"고급"** 클릭
   - **"프로젝트 이름(안전하지 않음)으로 이동"** 클릭
   - **"허용"** 클릭

### 3-4. URL 복사
- **웹 앱 URL**이 표시됨 (예: `https://script.google.com/macros/s/AKfycby.../exec`)
- **복사** 버튼 클릭하여 URL 복사
- 📋 **이 URL을 어딘가에 메모해두세요!**

---

## ✅ 4단계: 웹사이트에 URL 적용

### 4-1. JavaScript 파일 열기
`pocketedu/static/js/script.js` 파일을 엽니다.

### 4-2. URL 입력
파일 상단(2번째 줄)에서 다음 부분을 찾아:

```javascript
const GOOGLE_SHEET_URL = 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE';
```

복사한 URL로 교체:

```javascript
const GOOGLE_SHEET_URL = 'https://script.google.com/macros/s/AKfycby.../exec';
```

### 4-3. 저장
- 파일 저장 (`Ctrl + S`)
- 서버가 자동으로 재시작됨 (Flask debug 모드)

---

## ✅ 5단계: 테스트

### 5-1. 웹사이트에서 테스트
1. 브라우저에서 `http://localhost:5000` 접속
2. 측면 팝업 또는 하단 신청서 작성:
   - 기업명: `테스트 회사`
   - 연락처: `010-1234-5678`
   - 담당자명: `홍길동`
   - 문의사항: `테스트입니다`
3. **개인정보 수집 동의** 체크
4. **문의하기** 클릭

### 5-2. 구글 시트 확인
1. [구글 시트](https://docs.google.com/spreadsheets/d/1U-B4Qi4_kE59JEeKcInSOtGOX93kHyQIRXC4SnolxSk/edit?usp=sharing) 새로고침
2. 2번째 행에 데이터가 추가되었는지 확인:

| 접수일시 | 기업명 | 연락처 | 담당자명 | 문의사항 |
|---------|--------|--------|----------|----------|
| 2025-12-10 10:15:30 | 테스트 회사 | 010-1234-5678 | 홍길동 | 테스트입니다 |

---

## 📊 데이터 저장 흐름

```
사용자 폼 제출
    ↓
1️⃣ Flask 서버 DB에 저장 (Supabase)
    ↓
2️⃣ 구글 시트에 저장 (Apps Script)
    ↓
✅ 성공 메시지 표시
```

---

## 🔧 문제 해결

### ❌ 데이터가 시트에 저장되지 않는 경우

#### 1. Apps Script 배포 확인
- "액세스 권한"이 **"모든 사용자"**로 설정되었는지 확인
- 배포 > 배포 관리 > 편집 아이콘 클릭하여 확인

#### 2. URL 확인
- `static/js/script.js` 파일의 URL이 정확한지 확인
- URL 끝에 `/exec`가 있는지 확인
- 따옴표로 제대로 감싸져 있는지 확인

#### 3. 브라우저 콘솔 확인
- F12 키 → Console 탭
- 오류 메시지 확인

#### 4. Apps Script 로그 확인
- Apps Script 에디터 → 좌측 메뉴 → **실행** 탭
- 최근 실행 내역 확인

### ❌ "이 앱은 확인되지 않았습니다" 오류

이것은 정상입니다! 개인 프로젝트이기 때문입니다.
- **고급** 클릭
- **프로젝트 이름(안전하지 않음)으로 이동** 클릭
- **허용** 클릭

### ❌ CORS 오류

걱정하지 마세요! `mode: 'no-cors'` 옵션이 코드에 포함되어 있어 문제없습니다.
- 데이터는 정상적으로 저장됩니다
- 응답을 받을 수 없을 뿐입니다 (정상 동작)

---

## 🎯 완료!

이제 상담 문의가 들어올 때마다:
1. ✅ Supabase 데이터베이스에 저장
2. ✅ 구글 시트에 실시간 저장

두 곳 모두에 자동으로 저장됩니다! 🎉

---

## 📞 추가 기능 (선택사항)

### 이메일 알림 추가

Apps Script 코드에 다음을 추가하면 이메일 알림도 받을 수 있습니다:

```javascript
// sheet.appendRow(...) 다음에 추가
MailApp.sendEmail({
  to: 'your-email@example.com',
  subject: '🔔 새로운 상담 문의',
  body: `
    접수일시: ${timestamp}
    기업명: ${companyName}
    연락처: ${contactNumber}
    담당자: ${managerName}
    문의사항: ${inquiryContent}
  `
});
```

이메일 주소를 본인 것으로 변경하세요!

